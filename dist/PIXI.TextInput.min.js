'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(e===void 0){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if('value'in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(function(a){function b(d){if(d=d||{fill:13421772},d.idle)d.active=d.active||d.idle,d.disabled=d.disabled||d.idle;else{var e=d;d={},d.idle=d.active=d.disabled=e}return function(f,g,j){var k=d[j.toLowerCase()],l=new a.Graphics;return k.fill&&l.beginFill(k.fill),k.stroke&&l.lineStyle(k.stroke.width||1,k.stroke.color||0,k.stroke.alpha||1),k.rounded?l.drawRoundedRect(0,0,f,g,k.rounded):l.drawRect(0,0,f,g),l.endFill(),l.closePath(),l}}var c=function(d){function e(f,g){_classCallCheck(this,e);var j=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return j.input_style=Object.assign({position:'absolute',background:'none',border:'none',outline:'none',transformOrigin:'0 0'},f),j.box_generator='function'==typeof g?g:new b(g),j.box_cache={},j.state='IDLE',j.previous={},j.dom_added=!1,j.createDOMInput(),j.updateBox(),j.addListeners(),j}return _inherits(e,d),_createClass(e,[{key:'focus',value:function focus(){this.dom_input.focus()}},{key:'setInputStyle',value:function setInputStyle(f,g){this.input_style[f]=g,this.dom_input.style[f]=g,this.last_renderer&&this.update(this.last_renderer)}},{key:'destroy',value:function destroy(f){this.destroyBoxCache(),_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),'destroy',this).call(this,f)}},{key:'createDOMInput',value:function createDOMInput(){var g=this;for(var f in this.dom_input=document.createElement('input'),this.dom_input.type='text',this.input_style)this.dom_input.style[f]=this.input_style[f];this.dom_input.addEventListener('focus',function(){return g.setState('ACTIVE')}),this.dom_input.addEventListener('blur',function(){return g.setState('IDLE')})}},{key:'addListeners',value:function addListeners(){this.on('added',this.onAdded.bind(this)),this.on('removed',this.onRemoved.bind(this))}},{key:'onAdded',value:function onAdded(){document.body.appendChild(this.dom_input),this.dom_input.style.display='none',this.dom_added=!0}},{key:'onRemoved',value:function onRemoved(){console.log('removed'),document.body.removeChild(this.dom_input),this.dom_added=!1}},{key:'setState',value:function setState(f){this.state=f,this.updateBox()}},{key:'renderWebGL',value:function renderWebGL(f){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),'renderWebGL',this).call(this,f),this.update(f)}},{key:'renderCanvas',value:function renderCanvas(f){_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),'renderCanvas',this).call(this,f),this.update(f)}},{key:'update',value:function update(f){this.resolution=f.resolution,this.last_renderer=f,this.canvas_bounds=this.getCanvasBounds(),this.needsUpdate()&&(this.updateDOMInput(),this.updateBox())}},{key:'updateBox',value:function updateBox(){this.needsNewBoxCache()&&this.buildBoxCache(),this.state==this.previous.state&&this.box==this.box_cache[this.state]||(this.box&&this.removeChild(this.box),this.box=this.box_cache[this.state],this.addChild(this.box),this.previous.state=this.state)}},{key:'updateDOMInput',value:function updateDOMInput(){this.dom_input.style.top=this.canvas_bounds.top+'px',this.dom_input.style.left=this.canvas_bounds.left+'px',this.dom_input.style.transform=this.pixiMatrixToCSS(this.getDOMRelativeWorldTransform()),this.dom_input.style.opacity=this.worldAlpha,this.dom_input.style.display=this.worldVisible?'block':'none',this.previous.canvas_bounds=this.canvas_bounds,this.previous.world_transform=this.worldTransform.clone(),this.previous.world_alpha=this.worldAlpha,this.previous.world_visible=this.worldVisible}},{key:'needsUpdate',value:function needsUpdate(){return!this.comparePixiMatrices(this.worldTransform,this.previous.world_transform)||!this.compareClientRects(this.canvas_bounds,this.previous.canvas_bounds)||this.worldAlpha!=this.previous.world_alpha||this.worldVisible!=this.previous.world_visible||this.needsNewBoxCache()}},{key:'needsNewBoxCache',value:function needsNewBoxCache(){var f=this.getDOMInputBounds();return!this.previous.input_bounds||f.width!=this.previous.input_bounds.width||f.height!=this.previous.input_bounds.height}},{key:'buildBoxCache',value:function buildBoxCache(){this.destroyBoxCache();var f=['IDLE','ACTIVE','DISABLED'],g=this.getDOMInputBounds();for(var j in f)this.box_cache[f[j]]=this.box_generator(g.width,g.height,f[j]);this.previous.input_bounds=g}},{key:'destroyBoxCache',value:function destroyBoxCache(){for(var f in this.box&&(this.removeChild(this.box),this.box=null),this.box_cache)this.box_cache[f].destroy(),this.box_cache[f]=null,delete this.box_cache[f]}},{key:'getCanvasBounds',value:function getCanvasBounds(){var f=this.last_renderer.view.getBoundingClientRect(),g={top:f.top,left:f.left,width:f.width,height:f.height};return g.left+=window.scrollX,g.top+=window.scrollY,g}},{key:'getDOMInputBounds',value:function getDOMInputBounds(){var f=!1;this.dom_added||(document.body.appendChild(this.dom_input),f=!0);var g=this.dom_input.style.transform;this.dom_input.style.transform='';var j=this.dom_input.getBoundingClientRect();return this.dom_input.style.transform=g,f&&document.body.removeChild(this.dom_input),j}},{key:'getDOMInputLocalBounds',value:function getDOMInputLocalBounds(){var f=this.getDOMInputBounds();return f.width*=this.scale.x,f.height*=this.scale.y,f}},{key:'getDOMRelativeWorldTransform',value:function getDOMRelativeWorldTransform(){var f=this.last_renderer.view.getBoundingClientRect(),g=this.worldTransform.clone();return g.scale(this.resolution,this.resolution),g.scale(f.width/this.last_renderer.width,f.height/this.last_renderer.height),g}},{key:'pixiMatrixToCSS',value:function pixiMatrixToCSS(f){return'matrix('+[f.a,f.b,f.c,f.d,f.tx,f.ty].join(',')+')'}},{key:'comparePixiMatrices',value:function comparePixiMatrices(f,g){return f&&g&&f.a==g.a&&f.b==g.b&&f.c==g.c&&f.d==g.d&&f.tx==g.tx&&f.ty==g.ty}},{key:'compareClientRects',value:function compareClientRects(f,g){return f&&g&&f.left==g.left&&f.top==g.top&&f.width==g.width&&f.height==g.height}},{key:'placeholder',get:function get(){return this.dom_input.placeholder},set:function set(f){this.dom_input.placeholder=f}},{key:'disabled',get:function get(){return this._disabled},set:function set(f){this._disabled=f,this.dom_input.disabled=f,this.setState(f?'DISABLED':'IDLE')}},{key:'text',get:function get(){return this.dom_input.value},set:function set(f){this.dom_input.value=f}}]),e}(a.Container);a.TextInput=c})(PIXI);